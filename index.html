<html>
<head>
	<title>INFO 3300 - Project 1</title>
	<link href="https://fonts.googleapis.com/css?family=Alegreya|Alegreya+Sans" rel="stylesheet">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-time.v1.min.js"></script>
	<script src="https://d3js.org/d3-time-format.v2.min.js"></script>

	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	<script src="http://d3js.org/topojson.v2.min.js"></script>

    <link rel="stylesheet" type="text/css" href="styles.css">
	<style>
		body { font-family: 'Alegreya Sans', Calibri, sans-serif; }
		svg { border: solid #ccc 2px; }
		svg text {
			fill: #BCBBBB;
		}
		.axis line{
			stroke: #BCBBBB;
		}
		.axis path{
			stroke: #BCBBBB;
		}
	</style>
</head>
<body>
<!--  Orange - #F48024  -->
<!--  Blue - #0077CC  -->
<!--  Grey - #BCBBBB  -->
<div id="header">
	<h1>Visualizing StackOverflow</h1>
	<div id="names">
		<h3>Eliot Huang, keh228</h3>
		<h3>Harley Mueller, hrm58</h3>
		<h3>Xu Lee, xl475</h3>
	</div>
</div>


<div id="p1"> 
	<svg id="svg_numquestions" width="400" height="300"></svg>
</div>

<script>
	var maxMonthNum;
	var maxCount;
	var monthNumExtent;
	var format;
	var max;
	var dataset = [];
	var svg = d3.select("#svg_numquestions");

	d3.csv("TotalQuestions.csv", function(data) {
		dataset = data;
		monthNumExtent = d3.extent(dataset, function(d) 
			{return +d.MonthNum; });
		countExtent = d3.extent(dataset, function(d) 
			{return +d.Count; });
		
		update(dataset);
	});

	function update(dataset){
		var xScale = d3.scaleTime()
			.domain([new Date("2008-07-01"), new Date("2017-01-29")])
			.range([50, 370]);
		var xScale = d3.scaleTime()
			.domain([new Date("2008-07-01"), new Date("2017-01-29")])
			.range([50, 370]);

		var xAxis = d3.axisBottom(xScale);
		svg.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,270)")
			.style("font-size", "10px")
			//.style("fill", "#BCBBBB")
			.call(xAxis);

		var yScale = d3.scaleLinear()
			.domain(countExtent)
			.range([270,30]);

		var yAxis = d3.axisLeft(yScale);

		svg.append("g")
			.attr("class", "axis")
			.attr("transform","translate(50,0)")
			.call(yAxis);

		svg.append("text")
	        .attr("x", (400 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("Total Number of Questions on StackOverflow");

        var lineFunction = d3.line()
        .x(function (d) {
            return xScale(new Date(d.Year, d.Month));
        })
        .y(function (d) {
            return yScale(d.Count);
        });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(270)
		    .y1(function(d) { return yScale(d.Count); 
		});

        svg.append("path")
        .attr("d", lineFunction(dataset))
        .style("stroke-width", 2)
        .style("stroke", "#F48024")
        .style("fill", "none");

	    svg.append("path")
	         .data([dataset])
	         .attr("class", "area")
	         .attr("d", area);	
	}	
</script>

<div id= "bigGraph2">
	<h1>Most popular tags on StackOverflow in 2016</h1>
</div>

<script>
	var margin2 = {top: 20, right: 60, bottom: 30, left: 50},
	    width2 = 500 - margin2.left - margin2.right, 
	    height2 = 400 - margin2.top - margin2.bottom;

	var parseDate2 = d3.timeParse('%Y-%m');

	//var formatSi = d3.format(".3s");

	var formatNumber2 = d3.format(".1s"),
	    formatThousand2 = function(x) { return formatNumber2(x); };


	var x2 = d3.scaleTime()
	    .range([0, width2]);

	var y2 = d3.scaleLinear()
	    .range([height2, 0]);

	//var color = d3.scaleOrdinal(d3.schemeCategory10);
	var color2 = d3.scaleOrdinal().range(["#F48024", "#44af69", "#f8333c", "#0077CC", "#dbd5b5", "#5BC0EB", "#FDE74C", "#403233", "#9BC53D"]);

	var keys2 ;
	var graph2 ;
	var xAx2 = d3.axisBottom()
	    .scale(x2);

	var yAx2 = d3.axisLeft()
	    .scale(y2)
	    .tickSize(-width2)
	    .tickFormat(formatThousand2);

	var area2 = d3.area()
	    .x(function(d) { 
	      return x2(d.data.date); })
	    .y0(function(d) { return y2(d[0]); })
	    .y1(function(d) { return y2(d[1]); });


	var stack2 = d3.stack()

	var svgB2 = d3.select('#bigGraph2').append('svg')
	    .attr('width', width2 + margin2.left + margin2.right)
	    .attr('height', height2 + margin2.top + margin2.bottom)
	  .append('g')
	    .attr('transform', 'translate(' + margin2.left + ',' + margin2.top + ')');

	d3.csv('dataTop2016B.csv', function(error, data2016) {
	  //color.domain(d3.keys(data[0]).filter(function(key) { return key !== 'date'; }));
	  keys2 = data2016.columns.filter(function(key) { return key !== 'date'; })
	  data2016.forEach(function(d) {
	    d.date = parseDate2(d.date); 
	  });


	  var maxDateVal2 = d3.max(data2016, function(d){
	    var vals2 = d3.keys(d).map(function(key){ return key !== 'date' ? d[key] : 0 });
	    return d3.sum(vals2);
	  });
	  
	  // Set domains for axes
	  x2.domain(d3.extent(data2016, function(d) { return d.date; }));
	  y2.domain([0, maxDateVal2])


	  stack2.keys(keys2);

	  //stack2.order(d3.stackOrderNone);
	  //stack2.offset(d3.stackOffsetNone);

	  console.log(stack2(data2016));

	  graph2 = svgB2.selectAll('.graph')
	      .data(stack2(data2016))
	    .enter().append('g')
	      .attr('class', function(d){ return 'graph ' + d.key; })
	      .attr('fill-opacity', 1);

	  graph2.append('path')
	      .attr('class', 'area')
	      .attr('d', area2)
	      .style('fill', function(d) { return color2(d.key); });
	      
	  graph2.append('text')
	      .datum(function(d) { return d; })
	      .attr('transform', function(d) { return 'translate(' + x2(data2016[102].date) + ',' + y2(d[102][1]) + ')'; })
	      .attr('x', -6) 
	      .attr('dy', '.35em')
	      .style("text-anchor", "start")
	      .text(function(d) { return d.key; })
	      .attr('fill-opacity', 1);

	  svgB2.append('g')
	      .attr('class', 'x axis')
	      .attr('transform', 'translate(0,' + height2 + ')')
	      .call (xAx2);

	  svgB2.append('g')
	      .attr('class', 'y axis')
	      .call(yAx2);

	  svgB2.append ("text")
	    .attr("x", 0-margin2.left)
	    .text("Number of Tags")
	});

</script>

<div id="p2">
	<svg id="svg_smallMultiples1" width="250" height="200"></svg>
	<svg id="svg_smallMultiples2" width="250" height="200"></svg>
	<svg id="svg_smallMultiples3" width="250" height="200"></svg>
	<svg id="svg_smallMultiples4" width="250" height="200"></svg>
	<svg id="svg_smallMultiples5" width="250" height="200"></svg>
	<svg id="svg_smallMultiples6" width="250" height="200"></svg>
	<svg id="svg_smallMultiples7" width="250" height="200"></svg>
	<svg id="svg_smallMultiples8" width="250" height="200"></svg>
	<svg id="svg_smallMultiples9" width="250" height="200"></svg>
</div>

<script>
	var monthNumExtent;
	var codeData = [];
	var svg2 = d3.select("#svg_smallMultiples1");
	var svg3 = d3.select("#svg_smallMultiples2");
	var svg4 = d3.select("#svg_smallMultiples3");
	var svg5 = d3.select("#svg_smallMultiples4");
	var svg6 = d3.select("#svg_smallMultiples5");
	var svg7 = d3.select("#svg_smallMultiples6");
	var svg8 = d3.select("#svg_smallMultiples7");
	var svg9 = d3.select("#svg_smallMultiples8");
	var svg10 = d3.select("#svg_smallMultiples9");

	d3.csv("dataTop2016B.csv", function(data) {

	//#1 - ANDROID
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		tagExtent = d3.extent(codeData, function(d) {return +d.android; });
		
		var xScale = d3.scaleTime()
					   .domain([new Date("2008-07-01"), new Date("2017-01-29")])
					   .range([30, 240]);
		var xAxis = d3.axisBottom(xScale);

		svg2.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear()
					   .domain(tagExtent)
					   .range([180, 30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg2.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg2.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("Android");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.android);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.android); });

        svg2.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg2.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);			

	//#2 - C#
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.angularjs; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg3.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg3.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg3.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("C#");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.Csharp);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.Csharp); });

        svg3.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg3.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);					

	//#3 - HTML
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.css; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg4.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg4.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg4.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("HTML");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.html);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.html); });

        svg4.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg4.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);		

	//#4 - IOS
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.ios; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg5.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg5.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg5.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("iOS");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.ios);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.ios); });

        svg5.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg5.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);	

	//#5 - JAVA
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.java; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg6.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg6.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg6.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("Java");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.java);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.java); });

        svg6.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg6.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);	

	//#6 - JAVASCRIPT
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.javascript; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg7.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg7.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg7.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("JavaScript");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.javascript);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.javascript); });

        svg7.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg7.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);

	//#7 - JQUERY
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.iphone; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg8.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg8.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg8.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("jQuery");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.jquery);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.jquery); });

        svg8.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg8.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);

	//#8 - PHP
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.php; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg9.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg9.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg9.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("PHP");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.php);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.php); });

        svg9.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg9.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);

	//#9 - PYTHON
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.python; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg10.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
					  .ticks(4);
		svg10.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg10.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("Python");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.date));
	        })
	        .y(function (d) {
	            return yScale(d.python);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.date)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.python); });

        svg10.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg10.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);
    });
</script>

<div id="bigGraph1">
	<h1>Most popular tags on StackOverflow in 2009</h1>
</div>

<script>
	var margin = {top: 20, right: 60, bottom: 30, left: 50},
	    width = 500 - margin.left - margin.right, 
	    height = 400 - margin.top - margin.bottom;

	var parseDate = d3.timeParse('%Y-%m');

	//var formatSi = d3.format(".3s");

	var formatNumber = d3.format(".1s"),
	    formatThousand = function(x) { return formatNumber(x); };


	var x = d3.scaleTime()
	    .range([0, width]);

	var y = d3.scaleLinear()
	    .range([height, 0]);

	//var color = d3.scaleOrdinal(d3.schemeCategory10);
	var color = d3.scaleOrdinal().range(["#F48024", "#44af69", "#f8333c", "#0077CC", "#dbd5b5", "#5BC0EB", "#FDE74C", "#403233", "#9BC53D"]);

	var xAx = d3.axisBottom()
	    .scale(x);

	var yAx = d3.axisLeft()
	    .scale(y)
	    .tickSize(-width)
	    .tickFormat(formatThousand);

	var area = d3.area()
	    .x(function(d) { 
	      return x(d.data.date); })
	    .y0(function(d) { return y(d[0]); })
	    .y1(function(d) { return y(d[1]); });


	var stack = d3.stack()

	var svgB = d3.select('#bigGraph1').append('svg')
	    .attr('width', width + margin.left + margin.right)
	    .attr('height', height + margin.top + margin.bottom)
	  .append('g')
	    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

	d3.csv('dataTop2009B.csv', function(error, data) {
	  //color.domain(d3.keys(data[0]).filter(function(key) { return key !== 'date'; }));
	  var keys = data.columns.filter(function(key) { return key !== 'date'; })
	  data.forEach(function(d) {
	    d.date = parseDate(d.date); 
	  });


	  var maxDateVal = d3.max(data, function(d){
	    var vals = d3.keys(d).map(function(key){ return key !== 'date' ? d[key] : 0 });
	    return d3.sum(vals);
	  });
	  
	  // Set domains for axes
	  x.domain(d3.extent(data, function(d) { return d.date; }));
	  y.domain([0, maxDateVal])

	  stack.keys(keys);

	  //stack.order(d3.stackOrderNone);
	  ///stack.offset(d3.stackOffsetNone);

	  console.log(stack(data));

	  var graph = svgB.selectAll('.graph')
	      .data(stack(data))
	    .enter().append('g')
	      .attr('class', function(d){ return 'graph ' + d.key; })
	      .attr('fill-opacity', 1);

	  graph.append('path')
	      .attr('class', 'area')
	      .attr('d', area)
	      .style('fill', function(d) { return color(d.key); });
	      
	  graph.append('text')
	      .datum(function(d) { return d; })
	      .attr('transform', function(d) { return 'translate(' + x(data[102].date) + ',' + y(d[102][1]) + ')'; })
	      .attr('x', -6) 
	      .attr('dy', '.35em')
	      .style("text-anchor", "start")
	      .text(function(d) { return d.key; })
	      .attr('fill-opacity', 1);

	  svgB.append('g')
	      .attr('class', 'x axis')
	      .attr('transform', 'translate(0,' + height + ')')
	      .call (xAx);

	  svgB.append('g')
	      .attr('class', 'y axis')
	      .call(yAx);

	  svgB.append ("text")
	    .attr("x", 0-margin.left)
	    .text("Number of Tags");   
	});
</script>

<div id="p3">
	<svg id="svg_smallMultiples10" width="250" height="200"></svg>
	<svg id="svg_smallMultiples11" width="250" height="200"></svg>
	<svg id="svg_smallMultiples12" width="250" height="200"></svg>
	<svg id="svg_smallMultiples13" width="250" height="200"></svg>
	<svg id="svg_smallMultiples14" width="250" height="200"></svg>
	<svg id="svg_smallMultiples15" width="250" height="200"></svg>
	<svg id="svg_smallMultiples16" width="250" height="200"></svg>
	<svg id="svg_smallMultiples17" width="250" height="200"></svg>
	<svg id="svg_smallMultiples18" width="250" height="200"></svg>
</div>

<script>
	var monthNumExtent;
	var codeData = [];
	var svg11 = d3.select("#svg_smallMultiples10");
	var svg12 = d3.select("#svg_smallMultiples11");
	var svg13 = d3.select("#svg_smallMultiples12");
	var svg14 = d3.select("#svg_smallMultiples13");
	var svg15 = d3.select("#svg_smallMultiples14");
	var svg16 = d3.select("#svg_smallMultiples15");
	var svg17 = d3.select("#svg_smallMultiples16");
	var svg18 = d3.select("#svg_smallMultiples17");
	var svg19 = d3.select("#svg_smallMultiples18");

	d3.csv("dataTop2009.csv", function(data) {

	//#10 - ASP.NET
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });

		tagExtent = d3.extent(codeData, function(d) {return +d.java; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg11.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale)
		svg11.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg11.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("asp.net");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.aspnet);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.aspnet); });

        svg11.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg11.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);			

	//#11 - C++
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.angularjs; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg12.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg12.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg12.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("C++");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.Cplusplus);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.Cplusplus); });

        svg12.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg12.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);					

	//#12 - C#
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.css; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg13.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg13.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg13.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("C#");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.Csharp);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.Csharp); });

        svg13.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg13.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);		

	//#13 - iPhone
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.ios; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg14.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg14.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg14.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("iPhone");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.iphone);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.iphone); });

        svg14.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg14.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);	

	//#14 - JAVA
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.java; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg15.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg15.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			.call(yAxis);

		svg15.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("Java");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.java);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.java); });

        svg15.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg15.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);	

	//#15 - JAVASCRIPT
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.javascript; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg16.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg16.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg16.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("JavaScript");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.javascript);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.javascript); });

        svg16.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg16.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);

	//#16 - JQUERY
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.iphone; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg17.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg17.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg17.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("jQuery");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.jquery);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.jquery); });

        svg17.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg17.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);

	//#17 - .NET
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.php; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg18.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg18.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg18.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text(".net");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.net);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.net); });

        svg18.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg18.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);

	//#18 - PHP
		codeData = data;
		monthNumExtent = d3.extent(codeData, function(d) {return +d.MonthNum; });
		// tagExtent = d3.extent(codeData, function(d) {return +d.python; });
		
		var xScale = d3.scaleTime().domain([new Date("2008-07-01"), new Date("2017-01-29")]).range([30, 240]);
		var xAxis = d3.axisBottom(xScale);
		svg19.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0,180)")
			.style("font-size", "8px")
			.call(xAxis);

		var yScale = d3.scaleLinear().domain(tagExtent).range([180,30]);
		var yAxis = d3.axisLeft(yScale);
		svg19.append("g")
			.attr("class", "axis")
			.attr("transform","translate(30,0)")
			.style("font-size", "8px")
			//change ticks
			.call(yAxis);

		svg19.append("text")
	        .attr("x", (250 / 2))             
	        .attr("y", 20)
	        .attr("text-anchor", "middle")  
	        .style("font-size", "16px") 
	        .style("text-decoration", "underline")  
	        .text("PHP");

		var lineFunction = d3.line()
        	.x(function (d) {
	            return xScale(new Date(d.Year, d.Month));
	        })
	        .y(function (d) {
	            return yScale(d.php);
	    });

	    var area = d3.area()
		    .x(function(d) { return xScale(new Date(d.Year, d.Month)); })
		    .y0(180)
		    .y1(function(d) { return yScale(d.php); });

        svg19.append("path")
	        .attr("d", lineFunction(codeData))
	        .style("stroke-width", 2)
	        .style("stroke", "#F48024")
	        .style("fill", "none");		

	    svg19.append("path")
	         .data([data])
	         .attr("class", "area")
	         .attr("d", area);
    });
</script>

</body>
</html>

